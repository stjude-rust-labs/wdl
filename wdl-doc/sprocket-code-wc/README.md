# Sprocket Code Web Component Bundle

This project bundles the `sprocket-code.js` web component into a single, minified JavaScript file.

## Prerequisites

- Node.js and npm (or your preferred package manager)

## Setup

Install the dependencies:

```bash
npm install
```

## Building the Bundle

To create the bundle:

```bash
npm run build
```

This command will generate `dist/bundle.js`, `dist/bundle.js.map` (sourcemap), and `dist/meta.json` (build metadata).

## Analyzing the Bundle

Two scripts are provided to help analyze the contents and size of the bundle:

### 1. Using esbuild-visualizer (Recommended for esbuild)

This tool uses the metafile generated by `esbuild` to create an interactive treemap of the bundle's contents.

```bash
npm run analyze:meta
```

This will open the visualization in your default browser.

### 2. Using source-map-explorer

This tool uses the generated sourcemap to visualize the bundle's composition based on your original source files.

```bash
npm run analyze:sme
```

This will also open an interactive treemap in your browser.

## Using the Bundle

The `dist/bundle.js` file can be included in any project that needs to use the `<sprocket-code>` web component. Ensure that the `wdl.tmGrammar.json` file is available at the path expected by the original `sprocket-code.js` if it's loaded dynamically by path (though with `--loader:.json=json`, it should be embedded).

**Note**: The current `sprocket-code.js` imports `wdl.tmGrammar.json` directly. The `esbuild` configuration (`--loader:.json=json`) ensures this JSON content is embedded into the final `bundle.js`.
It also imports Shiki's WASM for the Oniguruma engine. `esbuild` will bundle Shiki's WASM loading mechanism.
